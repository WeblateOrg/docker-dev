# Copyright ¬© Michal ƒåiha≈ô <michal@weblate.org>
#
# SPDX-License-Identifier: MIT
#
name: Weekly tag

on:
  schedule:
  - cron: 2 10 * * 0
  workflow_dispatch:

permissions:
  contents: write

jobs:
  tag:
    runs-on: ubuntu-24.04
    steps:
    - name: üè∑Ô∏è Create/update tag
      uses: actions/github-script@v7
      with:
        github-token: ${{ secrets.WEBLATE_CI_TOKEN }}
        script: |
          const now = new Date;
          const onejan = new Date(now.getFullYear(), 0, 1);
          /* This is not a ISO-8601 week number but works well for versioning */
          const week = Math.ceil((((now.getTime() - onejan.getTime()) / 86400000) + onejan.getDay() + 1) / 7);
          const result = await github.rest.git.createRef({
            owner: context.repo.owner,
            repo: context.repo.repo,
            ref: `refs/tags/v${ now.getFullYear() }.${ week }.0`,
            sha: context.sha
          });
          console.log(result);
